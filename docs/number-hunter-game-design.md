# Number Hunter: 教育ホラー風算数学習ゲーム設計書

## 1. コンセプト概要
- **ジャンル**: 教育×ホラー風味の算数学習ゲーム
- **テーマ**: プレイヤーは怪物となり、建物内に隠れている人 (数字) を探し出して捕まえる。
- **学習目標**: 10までの数の分解・合成、繰り上がり/繰り下がりを伴う加減計算、状況理解を通じた数感覚と集中力の育成。
- **プレイ感**: ホラー映画の緊張感と算数パズルの達成感を両立させた、低年齢向けスリル体験。

## 2. 対象年齢と学習到達度
- **対象年齢**: 小学1年生。ピアジェの具体的操作期初期（6〜7歳）に合わせ、抽象記号だけに頼らず段階的支援を重視。
- **習熟ステップ**: 小学1年生の年間カリキュラムに基づく3ステップ。
  - ステップA（5〜7月）: 「いくつといくつ」「繰り上がりなしの足し算・引き算」。具体物と図解を使って数の分解・合成を体感する。
  - ステップB（8〜10月）: 繰り上がりあり足し算、繰り下がりなし引き算。数直線や10のまとまりを用いた半具体的操作へ移行。
  - ステップC（11〜3月）: 繰り下がりあり引き算と単純な文章題。状況理解と式変換をゲーム内ストーリーと連動させる。

### カリキュラムとの対応表
| 学習単元 | ゲーム内チャプター | 学習支援設計 | 主なゲーム要素 |
|--------|------------------|----------------|----------------|
| いくつといくつ | Chapter 1: 数の巣穴 | 具体物操作 → 半具体 → 抽象 | タッチでおはじき移動、モンスターが数ブロックを集める演出 |
| たしざん（繰り上がりなし） | Chapter 2: 隠れ里探索 | 10以内の合成を図カードで練習 | 連続正解でスピードブースト、固定比率報酬 |
| ひきざん（繰り下がりなし） | Chapter 3: 逃げ道封鎖 | 取り去り操作を可視化 | 失敗時は段階ヒントと巻き戻し |
| たしざん（繰り上がりあり） | Chapter 4: 隠された通路 | 10のまとまりアニメーション | 数直線スライダーとフラッシュカード |
| ひきざん（繰り下がりあり） | Chapter 5: 秘密の部屋 | 借りる操作を手のイラストで補助 | モンスターが「10の束」を分解する演出 |
| 文章題 | Chapter 6: 最終対決 | 図→式の変換を段階ガイド | NPCのセリフで状況提示、キーワード強調 |

## 3. コアゲームループ
1. プレイヤーは建物マップ上の未発見番号セルをクリック。
2. 選択したセルに対応する算数問題がポップアップ。
3. 正解時: 悲鳴SEが再生され、セルが赤色に変化。怪物画像が対象セルまで移動して捕食演出。
4. 不正解時: 怪物が怯むアニメーション + リトライ/ヒント表示。一定回数ミスでペナルティ (時間減少など)。
5. すべてのセルが赤色化 (捕獲済み) でステージクリア。

## 4. ゲームフロー / ステートマシン
```
IDLE → SELECTING_TARGET → SOLVING → (CORRECT → RESOLVE_SUCCESS → IDLE)
                                      ↘ (INCORRECT → FEEDBACK → SOLVING or IDLE)
```
- `IDLE`: ステージ開始。カーソル自由移動。怪物待機。
- `SELECTING_TARGET`: ユーザーがセルを選択。怪物移動開始。
- `SOLVING`: 問題パネル表示。入力ロック。制限時間バー開始。
- `RESOLVE_SUCCESS`: 正解アニメーション、悲鳴SE、セル状態更新、スコア加算。
- `FEEDBACK`: 不正解メッセージまたはヒント表示。必要に応じて難度下げや再挑戦。

## 5. マップ/レベル設計
- **基本レイアウト**: 建物のワンフロアを俯瞰で表示。廊下・部屋・家具のシルエットを追加し、臨場感を演出。
- **セル構造**: 3×5 の 15 グリッド (将来的に 4×6 など拡張)。各セルに番号 (1〜15) を表示。
- **視覚表現**:
  - 非選択セル: 中立色 (ライトグレー) に淡い呼吸アニメ。
  - 選択可能セル: ホバーで微点滅 (Framer Motion `whileHover`).
  - 捕獲済セル: 赤色 (#F44336) に焼き付きエフェクト。
- **ナビゲーション**: タップ操作(タブレット)を想定し 48px 以上のタッチ領域。

## 6. 算数問題生成
- **出題ロジック**:
  - ステップA〜Cに対応したテンプレートを用意し、児童の正答率・解答時間から最近接発達領域を推定。
  - 各セルへ割り当てる問題は「具体→半具体→抽象」の順で内部的に3問セット（操作問題・図問題・式問題）を構成し、正答状況に応じて出題段階を自動スキップまたは繰り返す。
  - ステージ内で同じ問題表現は重複させず、数の分解パターン（例:10=7+3,5+5 等）がバランス良く出現するよう制御。
- **問題タイプ例**（小学1年生向け）:
  - 数の分解: 「10のおはじきをモンスターとお友だちで分ける」→タッチで移動 → `10 = 7 + 3` を自動生成。
  - 繰り上がりなし加算: `4 + 3 = ?`。操作フェーズでは4体の住人に3体が加わるアニメーションを表示し、抽象フェーズで式入力。
  - 繰り上がりあり加算: `9 + 3` の場合、10のまとまりができる瞬間を赤い光で強調し、`9 + 1 + 2` と分解を誘導。
  - 文章題: 「部屋に5人隠れていました。2人逃げました。残りは何人？」。シーン演出で住人の移動を可視化し、式入力に誘導。
- **回答入力**: 2桁までの数字ボタン・タッチ式テンキーを使用。手書きサポートは将来機能として別途検討。
- **適応学習**: 直近5問の正答率が80%以上の場合は抽象段階を優先、50%未満の場合は具体段階から再提示。ストレス緩和のため制限時間を段階的に延長。

### ステップ別問題テンプレート
| ステップ | 具体操作フェーズ | 半具体フェーズ | 抽象フェーズ | 評価指標 |
|---------|----------------|---------------|-------------|---------|
| A: いくつといくつ | 10個までのおはじきやキャンディをタッチで左右にドラッグし、「何個と何個に分けたか」を録音/読み上げ | 片手の指イラストや点図カードにドラッグ&ドロップ、ドット数の確認 | 自動生成された式 `7 + 3 = 10` の欠けた数を入力、音声で確認 | 1回のステージで全ての分解パターンを操作できた割合 |
| B: 繰り上がりあり足し算・繰り下がりなし引き算 | 10フレーム（十のまとまり）ボードへコマを配置し、満杯時に「一束作成」ボタンで束に変換 | 数直線スライダーで進み/戻りを可視化し、メーターで差分を表示 | 式 `9 + □ = 12` / `12 - □ = 9` に合う数をテンキーで入力 | 10のまとまりを意識した説明（音声回答）をトラッキング |
| C: 繰り下がりあり引き算 + 短文問題 | 10の束から1個借りるアニメーションを手元で視覚化、タッチで分解 | ブロック図・イラストの中で残り数を数え直す、文章のキーワードをドラッグでマーキング | 式化と答え入力。必要に応じて「◯◯を引いたら？」の文を穴埋め | 正答後に自分の言葉で状況説明を録音、理解度をルーブリック評価 |

### ヒントとサポート設計
- 段階的ヒント: 1回目は図提示、2回目は操作の指示、3回目で答えに近い数を提示し、常に自律的判断を促す。
- 音声ガイド: 各フェーズ開始時に女の子の声で「まずはおはじきをドラッグしてみよう」などの指示を再生。読み上げ速度は保護者設定で調整可能。
- フィードバックカード: 正解時は「10は7と3にも分けられるね！」など有能感を高めるメッセージ。不正解時は「一緒に数直線で戻ってみよう」と再挑戦を促す。

## 7. UI/UXデザイン
- **メイン画面構成**:
  - 左: 建物マップ (Canvas背景 + DOMセル)。
  - 右: 問題パネル、モンスター情報、スコアボード。
  - 下部: 制限時間バーとヒントボタン。
- **怪物表示**: キャラクターアート (PNG/APNG or Lottie)。初期位置はマップ中央。
- **インタラクション**:
  - セルクリックで `monsterPosition` → 目標セル座標へ移行 (easeInOut 曲線)。
  - アニメーション完了後に問題パネルをフェードイン。
- **色覚配慮**: 赤色以外にも捕獲アイコン (鎖マーク) を重ね、色覚多様性対応。
- **音声ガイド**: 問題読み上げ (Web Speech API or Howler + 事前録音)。
- **小学1年生向けUI調整**:
  - 文字サイズは最低24pt、ひらがな優先表示。難語にはふりがなボタンを追加。
  - ホラー要素はコミカル寄りの演出に調整し、不安軽減のためにBGMの音量を低めに設定。保護者設定で演出強度を変更できる。
  - 「つぎへ」「もういちど」などの行動ボタンは色と形を統一し、右下配置で操作導線を固定。
  - チュートリアルでは実際のタップ操作を録画風アニメで見せ、初回セッションに操作チェックリストを挿入。

## 8. 視覚・音響演出
- **サウンド**:
  - 正解時: 悲鳴SE (`scream_success.mp3`) + バックグラウンド減衰。
  - 不正解時: 怪物の唸り声、または「悔しがる」効果音。
  - 常時: 建物内の環境音 (風・ドアきしみ)。
- **アニメーション**:
  - Monster移動: Framer Motion `motion.img` + `layout` + `transition` (duration 0.6s)。
  - 正解演出: GSAPタイムラインでセル発光 → 怪物咀嚼 → 赤色固定。
  - 背景: Canvasの薄い煙エフェクト、揺れる照明。

## 9. 技術スタックおよびアーキテクチャ
- **フロントエンド**: React + TypeScript + Vite。
- **アニメーション**: Framer Motion (メイン), GSAP (複雑演出), canvas-confetti, Web Animations API。
- **状態管理**: Zustand + Immer でゲーム状態 (セル状態、スコア、タイマー、怪物位置)。
- **サウンド**: Howler.js で効果音・BGM制御。
- **描画構成**: `internal_docs/frontend-design` のハイブリッドDOM/Canvasアーキテクチャを採用。
- **レスポンシブ**: 16:9 基準、タブレット横持ちに最適化。モバイル対応でUI再レイアウト。

### コンポーネント構造 (提案)
```
App
└── GameScene
    ├── BuildingMap
    │   ├── BackgroundCanvas
    │   └── NumberGrid (GridCell×N)
    ├── MonsterSprite
    ├── QuestionOverlay
    │   ├── ProblemPrompt
    │   ├── AnswerPad
    │   └── HintPanel
    ├── StatusPanel
    │   ├── ScoreBoard
    │   ├── TimerBar
    │   └── ProgressTracker
    └── AudioController
```

### イベントフロー (擬似コード)
```tsx
onCellSelect(cellId) {
  if (game.areAllResolved() || game.isLocked) return;
  game.lock();
  game.setActiveCell(cellId);

  animateMonsterTo(cellId).then(() => {
    ui.showQuestionPanel(game.getProblem(cellId));
    timer.start(problem.timeLimit, handleTimeout);
  });
}

onAnswerSubmit(answer) {
  if (!game.activeCell) return;
  const isCorrect = game.checkAnswer(answer);

  if (isCorrect) {
    audio.play('scream');
    animation.runSuccessSequence(game.activeCell);
    game.resolveActiveCell();
    score.add(problem.points);
    if (game.areAllResolved()) ui.showStageClear();
  } else {
    animation.shakeMonster();
    feedback.showHint(problem.generateHint());
    score.applyPenalty();
  }

  game.unlock();
  timer.stop();
  ui.hideQuestionPanel();
}
```

## 10. 学習・モチベーション設計
- **フィードバック**: 正解時の視覚/聴覚刺激を強調。不正解時は励ましテキストと簡易ヒント。
- **進行管理**: ステージクリアで新しい建物フロア解放、怪物スキン/アクセサリ解禁。
- **親向けレポート**: 正答率、平均解答時間、苦手領域の分析をまとめる管理画面を想定。

## 11. 安全性・アクセシビリティ
- 暴力表現のトーンを抑え、デフォルメ表現にする。
- 音量調整とミュートボタンを常時表示。
- メニューから教育内容の説明・操作方法ガイドを参照可能。
- Web Content Accessibility Guidelines (WCAG) 2.1 AA を目標。

## 12. 実装ロードマップ (MVP 8週間想定)
1. **Week 1-2**: Vite + React プロジェクトセットアップ、Zustandストア、マップレイアウト原型。
2. **Week 3**: 怪物移動アニメーション、セル選択ロジック、問題データモデル。
3. **Week 4**: 問題生成エンジン実装、ステップA〜Cの難度チューニング、タイマー導入。
4. **Week 5**: 正解演出 (悲鳴SE、赤化)、不正解フィードバック。
5. **Week 6**: UIポリッシュ、レスポンシブ対応、アクセシビリティ調整。
6. **Week 7**: 音声ナレーション、環境音、ステージクリア演出。
7. **Week 8**: QAテスト、パフォーマンスチューニング、学習分析ログ出力。

## 13. 今後の拡張アイデア
- 協力モード (親子で交代、問題提示役と回答役)。
- AI生成ストーリーシナリオで毎回異なる「隠れ方」を演出。
- マルチメディア教材連携 (問題に関連する動画やヒントカード)。
- デイリーチャレンジやランキングで継続プレイ動機付け。

---
この設計書は `internal_docs/frontend-design` のアーキテクチャ方針を前提に、学習効果と臨場感を両立させた実装の青写真を示します。次のステップとしてプロトタイプ実装に着手し、プレイテストでUI/UXと難易度調整を検証してください。
